<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proof Strategies | Mathswell</title>
    <link rel="icon" href="/logo-mathswell-square-mirror.ico" type="image/x-icon">
    <link rel="icon" href="/logo-mathswell-square-mirror.svg" type="image/svg+xml">
    
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <style>
        :root {
            --primary: #0f766e;
            --primary-light: #10b981;
            --background: #f7faf9;
            --interactive: #e6fffb;
            --text-primary: #212121;
            --text-muted: #4b5563;
            --accent-amber: #f59e0b;
            --accent-red: #c62828;
            --success: #10b981;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            padding-top: 60px;
            line-height: 1.6;
        }

        /* Centered Navigation */
        .mathswell-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            border-bottom: 2px solid var(--primary);
            padding: 0.75rem 1rem;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .mw-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: var(--primary);
            font-weight: 600;
            letter-spacing: 1px;
        }

        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* Centered Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            background: white;
            padding: 0.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: var(--interactive);
            color: var(--primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Concept Cards */
        .concept-card {
            background: white;
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .concept-card h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        /* Strategy Grid */
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .strategy-card {
            background: white;
            border: 2px solid var(--interactive);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .strategy-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .strategy-card.selected {
            background: var(--interactive);
            border-color: var(--primary);
        }

        .strategy-card h4 {
            color: var(--primary);
            margin-bottom: 0.8rem;
            font-size: 1.2rem;
        }

        .strategy-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Statement Display */
        .statement-display {
            background: var(--interactive);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Feedback Boxes */
        .feedback-box {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .feedback-box.success {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success);
            color: var(--success);
        }

        .feedback-box.warning {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid var(--accent-amber);
            color: #92400e;
        }

        .feedback-box.error {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--accent-red);
            color: var(--accent-red);
        }

        .feedback-box.info {
            background: var(--interactive);
            border: 2px solid var(--primary);
            color: var(--text-primary);
        }

        /* Alternative Input */
        .alternative-input-section {
            background: white;
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .input-group {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
            align-items: center;
        }

        .input-group input {
            flex: 1;
            min-width: 300px;
            padding: 0.8rem;
            border: 2px solid var(--interactive);
            border-radius: 8px;
            font-size: 1rem;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Buttons */
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .btn-amber {
            background: var(--accent-amber);
            color: white;
        }

        .btn-amber:hover:not(:disabled) {
            background: #dc8e0a;
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover:not(:disabled) {
            background: var(--interactive);
        }

        .btn:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Proof Structure */
        .proof-box {
            background: white;
            border: 3px solid var(--interactive);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .proof-box.assumption {
            border-color: var(--accent-amber);
            background: rgba(245, 158, 11, 0.05);
        }

        .proof-box.given {
            border-color: var(--primary);
            background: rgba(15, 118, 110, 0.05);
        }

        .proof-box.conclusion {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        .proof-box.contradiction {
            border-color: var(--accent-red);
            background: rgba(239, 68, 68, 0.05);
        }

        .box-label {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Steps Area */
        .sortable-area {
            min-height: 200px;
            padding: 1rem;
            background: var(--background);
            border: 2px dashed var(--interactive);
            border-radius: 8px;
        }

        .proof-step {
            background: white;
            border: 2px solid var(--interactive);
            border-left: 5px solid var(--primary);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
        }

        .proof-step:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .proof-step.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .proof-step.correct {
            border-left-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        /* Control Panel */
        .control-panel {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 2rem 0;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .strategy-grid {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .input-group input {
                min-width: 100%;
            }
        }

        /* Key Insights */
        .key-insight {
            background: linear-gradient(135deg, white, var(--interactive));
            border: 2px solid var(--accent-amber);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .key-insight h4 {
            color: var(--accent-amber);
            margin-bottom: 1rem;
        }

        /* Important Notice */
        .important-notice {
            background: rgba(239, 68, 68, 0.05);
            border: 2px solid var(--accent-red);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .important-notice h4 {
            color: var(--accent-red);
            margin-bottom: 0.5rem;
        }

        /* Direct Proof Emphasis */
        .direct-emphasis {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), white);
            border: 2px solid var(--success);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .direct-emphasis h4 {
            color: var(--success);
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Centered Navigation -->
    <div class="mathswell-nav">
        <a href="/" class="mw-link">
            <img src="/logo-mathswell-square-mirror.svg" alt="Mathswell" width="28" height="28">
            <span>MATHSWELL</span>
        </a>
    </div>

    <div class="container">
        <!-- Centered Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="intro">
                <span>üìö Introduction</span>
            </button>
            <button class="tab-btn" data-tab="explorer">
                <span>üî¨ Explorer</span>
            </button>
            <button class="tab-btn" data-tab="builder">
                <span>üèóÔ∏è Proof Builder</span>
            </button>
        </div>

        <!-- Tab 1: Introduction -->
        <div id="intro" class="tab-content active">
            <div class="direct-emphasis">
                <h4>‚≠ê First Principle: Always Try Direct Proof First!</h4>
                <p>Direct proof should be your first instinct. Only when direct proof is genuinely difficult or impossible should you consider indirect methods.</p>
            </div>

            <div class="concept-card">
                <h3>üéØ What are Proof Strategies?</h3>
                <p>Mathematical proofs follow a hierarchy of approaches:</p>
                <ol style="margin: 1rem 0 0 2rem;">
                    <li><strong>Direct proof (preferred):</strong> Build a logical path from hypothesis to conclusion</li>
                    <li><strong>Indirect proof (when needed):</strong>
                        <ul style="margin: 0.5rem 0 0 2rem;">
                            <li><strong>Contrapositive:</strong> For implications, prove "not Q implies not P" (written as ¬¨Q ‚Üí ¬¨P)*</li>
                            <li><strong>Contradiction:</strong> Assume the negation, derive impossibility</li>
                        </ul>
                    </li>
                </ol>
                <p style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-muted);">*The symbol ¬¨ means "not" or "the negation of"</p>
            </div>

            <div class="concept-card" style="background: linear-gradient(135deg, white, #fef3c7);">
                <h3>üîç When Direct Proof Works (Most Cases!)</h3>
                <p><strong>Example: "If n is even, then n¬≤ is even"</strong></p>
                <p style="margin: 1rem 0;">Direct proof is straightforward:</p>
                <ul style="margin: 0 0 0 2rem;">
                    <li>Assume n is even, so n = 2k</li>
                    <li>Then n¬≤ = (2k)¬≤ = 4k¬≤ = 2(2k¬≤)</li>
                    <li>Therefore n¬≤ is even ‚úì</li>
                </ul>
                <p style="margin-top: 1rem; color: var(--accent-red);"><strong>Using indirect proof here would be unnecessarily complex!</strong></p>
            </div>

            <div class="concept-card">
                <h3>üí° When Indirect Proof is Necessary</h3>
                <p>Indirect proof is needed when:</p>
                <ul style="margin: 1rem 0 0 2rem;">
                    <li><strong>Proving irrationality:</strong> "‚àö2 is irrational" (can't check all rationals directly)</li>
                    <li><strong>Proving non-existence:</strong> "There is no largest prime" (can't check all possibilities)</li>
                    <li><strong>When working backwards is easier:</strong> "If n¬≤ is even, then n is even" (hard to go from n¬≤ to n, but easy to go from n to n¬≤)</li>
                </ul>
            </div>

            <div class="strategy-grid">
                <div class="strategy-card">
                    <span class="strategy-icon">‚úÖ</span>
                    <h4>Direct Proof</h4>
                    <p><strong>Always try first!</strong></p>
                    <p><strong>Works for:</strong> Most implications, existence claims, constructive proofs</p>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem;">Example: "If n is odd, then n¬≤ is odd"</p>
                </div>

                <div class="strategy-card">
                    <span class="strategy-icon">‚ÜîÔ∏è</span>
                    <h4>Contrapositive</h4>
                    <p><strong>Use when:</strong> Direct proof from P is hard, but ¬¨Q gives clear info</p>
                    <p><strong>Only for:</strong> Implications (If P then Q)</p>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem;">Example: "If n¬≤ is even, then n is even"</p>
                </div>

                <div class="strategy-card">
                    <span class="strategy-icon">üí•</span>
                    <h4>Contradiction</h4>
                    <p><strong>Last resort:</strong> When direct construction is impossible</p>
                    <p><strong>Necessary for:</strong> Irrationality, non-existence</p>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem;">Example: "‚àö2 is irrational"</p>
                </div>
            </div>

            <div class="important-notice">
                <h4>‚ö†Ô∏è Common Mistake to Avoid</h4>
                <p>Don't use indirect proof when direct proof works! For example, proving "If n is even, then n¬≤ is even" by contradiction is poor mathematical style‚Äîthe direct proof is cleaner and clearer.</p>
            </div>
        </div>

        <!-- Tab 2: Explorer -->
        <div id="explorer" class="tab-content">
            <div class="concept-card">
                <h3>üî¨ Strategy Decision Tree</h3>
                <p>Select a statement below to see which proof strategies are appropriate and why.</p>
            </div>

            <div class="strategy-grid">
                <div class="strategy-card" onclick="exploreStatement('direct-easy')">
                    <h4>Easy Direct Proof</h4>
                    <p><em>"If n is even, then n¬≤ is even"</em></p>
                </div>
                <div class="strategy-card" onclick="exploreStatement('needs-indirect')">
                    <h4>Needs Indirect</h4>
                    <p><em>"If n¬≤ is even, then n is even"</em></p>
                </div>
                <div class="strategy-card" onclick="exploreStatement('irrational')">
                    <h4>Irrationality</h4>
                    <p><em>"‚àö2 is irrational"</em></p>
                </div>
                <div class="strategy-card" onclick="exploreStatement('existence')">
                    <h4>Existence</h4>
                    <p><em>"There exists an x such that x¬≤ = 4"</em></p>
                </div>
            </div>

            <div id="explorer-display" style="display: none;">
                <div class="statement-display">
                    <strong>Statement:</strong> <span id="explorer-statement"></span>
                </div>

                <div id="strategy-analysis"></div>

                <div class="alternative-input-section" id="alternative-practice" style="display: none;">
                    <h4>Practice: What would you assume for <span id="method-name"></span>?</h4>
                    <div class="input-group">
                        <input type="text" id="explorer-alternative" placeholder="Enter what you would assume...">
                        <button class="btn btn-primary" onclick="checkExplorerAlternative()">Check</button>
                    </div>
                    <div id="explorer-alternative-feedback"></div>
                </div>
            </div>
        </div>

        <!-- Tab 3: Proof Builder -->
        <div id="builder" class="tab-content">
            <div class="concept-card">
                <h3>üèóÔ∏è Interactive Proof Builder</h3>
                <p>Generate problems and construct proofs. The app will guide you to use the most appropriate strategy.</p>
            </div>

            <div class="control-panel">
                <select id="problem-type" class="btn btn-outline">
                    <option value="direct-natural">Direct Proof Natural</option>
                    <option value="indirect-needed">Indirect Proof Needed</option>
                    <option value="irrational">Irrationality Proof</option>
                    <option value="existence">Existence Proof</option>
                    <option value="nonexistence">Non-Existence Proof</option>
                </select>
                <button class="btn btn-amber" onclick="generateProblem()">Generate Problem</button>
            </div>

            <div id="builder-content" style="display: none;">
                <div class="statement-display">
                    <strong>Prove:</strong> <span id="problem-statement"></span>
                </div>

                <div id="strategy-selection">
                    <h4 style="text-align: center; margin: 2rem 0 1rem;">Available Proof Strategies:</h4>
                    <div id="builder-strategy-options" class="strategy-grid"></div>
                    <div id="strategy-feedback"></div>
                </div>

                <div id="alternative-section" style="display: none;">
                    <div class="alternative-input-section">
                        <h4>What do you assume for <span id="chosen-method"></span>?</h4>
                        <div class="input-group">
                            <input type="text" id="builder-alternative" placeholder="Enter your assumption...">
                            <button class="btn btn-primary" onclick="checkBuilderAlternative()">Check</button>
                        </div>
                        <div id="builder-alternative-feedback"></div>
                    </div>
                </div>

                <div id="proof-construction" style="display: none;">
                    <h4 style="text-align: center; margin: 2rem 0 1rem;">Construct the Proof</h4>
                    <div id="proof-structure"></div>
                    
                    <div class="control-panel">
                        <button class="btn btn-amber" onclick="getHint()">üí° Hint</button>
                        <button class="btn btn-primary" onclick="checkProof()">‚úì Check Proof</button>
                        <button class="btn btn-outline" onclick="resetProof()">‚Üª Reset</button>
                    </div>
                    
                    <div id="proof-feedback"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
// State management
let state = {
    currentTab: 'intro',
    explorerState: {
        statementType: null,
        selectedStrategy: null
    },
    builderState: {
        problem: null,
        selectedStrategy: null,
        draggedElement: null,
        attempts: 0
    }
};

// Problem database - properly categorized by natural strategy
const problemDatabase = {
    'direct-natural': [
        {
            statement: "If \\(n\\) is even, then \\(n^2\\) is even",
            naturalStrategies: ['direct'],
            unnecessaryStrategies: ['contrapositive', 'contradiction'],
            
            whyDirect: "Direct proof is straightforward: start with n = 2k, compute n¬≤ = 4k¬≤.",
            whyNotIndirect: "Using indirect proof here is poor style‚Äîit makes a simple problem unnecessarily complex.",
            
            directProof: {
                assumption: "Assume \\(n\\) is even",
                steps: [
                    "Since \\(n\\) is even, \\(n = 2k\\) for some integer \\(k\\)",
                    "Square both sides: \\(n^2 = (2k)^2\\)",
                    "Simplify: \\(n^2 = 4k^2\\)",
                    "Factor: \\(n^2 = 2(2k^2)\\)"
                ],
                conclusion: "Therefore \\(n^2\\) is even"
            }
        },
        {
            statement: "If \\(n\\) is odd, then \\(n^2\\) is odd",
            naturalStrategies: ['direct'],
            unnecessaryStrategies: ['contrapositive', 'contradiction'],
            
            whyDirect: "Direct proof is clean: n = 2k+1 leads immediately to n¬≤ = 2(2k¬≤+2k) + 1.",
            whyNotIndirect: "Indirect proof adds unnecessary complexity to a straightforward problem.",
            
            directProof: {
                assumption: "Assume \\(n\\) is odd",
                steps: [
                    "Since \\(n\\) is odd, \\(n = 2k+1\\) for some integer \\(k\\)",
                    "Square: \\(n^2 = (2k+1)^2\\)",
                    "Expand: \\(n^2 = 4k^2 + 4k + 1\\)",
                    "Factor: \\(n^2 = 2(2k^2 + 2k) + 1\\)"
                ],
                conclusion: "Therefore \\(n^2\\) is odd"
            }
        }
    ],
    
    'indirect-needed': [
        {
            statement: "If \\(n^2\\) is even, then \\(n\\) is even",
            naturalStrategies: ['contrapositive'],
            possibleStrategies: ['contradiction'],
            difficultStrategies: ['direct'],
            
            whyNotDirect: "Direct proof is difficult: starting with 'n¬≤ is even' doesn't easily tell us about n without complex case analysis.",
            whyContrapositive: "The contrapositive 'If n is odd, then n¬≤ is odd' is much easier to prove directly.",
            whyContradiction: "Works but less elegant than contrapositive.",
            
            contrapositiveProof: {
                assumption: "Assume \\(n\\) is odd",
                steps: [
                    "Since \\(n\\) is odd, \\(n = 2k+1\\)",
                    "Then \\(n^2 = (2k+1)^2 = 4k^2 + 4k + 1\\)",
                    "So \\(n^2 = 2(2k^2 + 2k) + 1\\)",
                    "Therefore \\(n^2\\) is odd"
                ],
                conclusion: "By contrapositive, if \\(n^2\\) is even, then \\(n\\) is even"
            },
            
            contradictionProof: {
                assumption: "Assume \\(n^2\\) is even AND \\(n\\) is odd",
                steps: [
                    "Since \\(n\\) is odd, \\(n = 2k+1\\)",
                    "Then \\(n^2 = (2k+1)^2 = 4k^2 + 4k + 1\\)",
                    "So \\(n^2 = 2(2k^2 + 2k) + 1\\)",
                    "This means \\(n^2\\) is odd"
                ],
                contradiction: "But we assumed \\(n^2\\) is even‚ÄîContradiction!",
                conclusion: "Therefore if \\(n^2\\) is even, then \\(n\\) must be even"
            }
        }
    ],
    
    'irrational': [
        {
            statement: "\\(\\sqrt{2}\\) is irrational",
            naturalStrategies: ['contradiction'],
            impossibleStrategies: ['direct', 'contrapositive'],
            
            whyNotDirect: "Direct proof is impossible: we cannot check that ‚àö2 ‚â† p/q for all infinitely many rational numbers p/q.",
            whyContradiction: "We must use contradiction: assume ‚àö2 is rational and derive an impossibility.",
            
            contradictionProof: {
                assumption: "Assume \\(\\sqrt{2}\\) is rational, so \\(\\sqrt{2} = p/q\\) with gcd(p,q) = 1",
                steps: [
                    "Square both sides: \\(2 = p^2/q^2\\)",
                    "Rearrange: \\(2q^2 = p^2\\)",
                    "Since \\(p^2\\) is even, \\(p\\) must be even. Let \\(p = 2k\\)",
                    "Substitute: \\(2q^2 = (2k)^2 = 4k^2\\)",
                    "Simplify: \\(q^2 = 2k^2\\)",
                    "Since \\(q^2\\) is even, \\(q\\) must be even"
                ],
                contradiction: "Both p and q are even, contradicting gcd(p,q) = 1",
                conclusion: "Therefore \\(\\sqrt{2}\\) is irrational"
            }
        },
        {
            statement: "\\(\\sqrt{3}\\) is irrational",
            naturalStrategies: ['contradiction'],
            impossibleStrategies: ['direct', 'contrapositive'],
            
            whyNotDirect: "Direct proof impossible: cannot verify ‚àö3 ‚â† p/q for infinitely many rationals.",
            whyContradiction: "Contradiction is the only viable approach for irrationality proofs.",
            
            contradictionProof: {
                assumption: "Assume \\(\\sqrt{3} = p/q\\) with gcd(p,q) = 1",
                steps: [
                    "Square: \\(3 = p^2/q^2\\), so \\(3q^2 = p^2\\)",
                    "Thus \\(p^2\\) is divisible by 3",
                    "Therefore \\(p\\) is divisible by 3. Let \\(p = 3k\\)",
                    "Substitute: \\(3q^2 = (3k)^2 = 9k^2\\)",
                    "Simplify: \\(q^2 = 3k^2\\)",
                    "So \\(q\\) is also divisible by 3"
                ],
                contradiction: "Both divisible by 3, contradicting gcd(p,q) = 1",
                conclusion: "Therefore \\(\\sqrt{3}\\) is irrational"
            }
        }
    ],
    
    'existence': [
        {
            statement: "There exists a real number \\(x\\) such that \\(x^2 = 4\\)",
            naturalStrategies: ['direct'],
            unnecessaryStrategies: ['contradiction'],
            
            whyDirect: "To prove existence, just provide one example: x = 2.",
            whyNotContradiction: "Using contradiction is unnecessarily complex when we can just exhibit a solution.",
            
            directProof: {
                assumption: "We need to find an \\(x\\) with \\(x^2 = 4\\)",
                steps: [
                    "Consider \\(x = 2\\)",
                    "Check: \\(2^2 = 4\\) ‚úì",
                    "Also, \\(x = -2\\) works: \\((-2)^2 = 4\\) ‚úì"
                ],
                conclusion: "Therefore \\(x = 2\\) (or \\(x = -2\\)) satisfies the equation"
            }
        }
    ],
    
    'nonexistence': [
        {
            statement: "There does not exist an integer \\(n\\) such that \\(n^2 = 2\\)",
            naturalStrategies: ['contradiction'],
            impossibleStrategies: ['direct'],
            
            whyNotDirect: "Direct proof of non-existence would require checking all integers, which is impossible.",
            whyContradiction: "Assume such an integer exists and derive a contradiction.",
            
            contradictionProof: {
                assumption: "Assume there exists an integer \\(n\\) such that \\(n^2 = 2\\)",
                steps: [
                    "Case 1: If \\(n = 0\\), then \\(n^2 = 0 \\neq 2\\)",
                    "Case 2: If \\(n = 1\\), then \\(n^2 = 1 < 2\\)",
                    "Case 3: If \\(n = -1\\), then \\(n^2 = 1 < 2\\)",
                    "Case 4: If \\(|n| \\geq 2\\), then \\(n^2 \\geq 4 > 2\\)",
                    "So if \\(n^2 = 2\\), we need \\(1 < n^2 < 4\\), meaning \\(1 < |n| < 2\\)",
                    "But there is no integer with absolute value strictly between 1 and 2"
                ],
                contradiction: "No integer can satisfy \\(n^2 = 2\\)",
                conclusion: "Therefore no integer \\(n\\) exists such that \\(n^2 = 2\\)"
            }
        },
        {
            statement: "There is no largest prime number",
            naturalStrategies: ['contradiction'],
            impossibleStrategies: ['direct'],
            
            whyNotDirect: "Cannot directly prove there's no largest prime‚Äîwe'd need to check infinitely many numbers.",
            whyContradiction: "Classic proof: assume there's a largest prime, construct a larger one.",
            
            contradictionProof: {
                assumption: "Assume there is a largest prime, call it \\(p\\)",
                steps: [
                    "List all primes: \\(2, 3, 5, ..., p\\)",
                    "Consider \\(N = (2 \\cdot 3 \\cdot 5 \\cdots p) + 1\\)",
                    "\\(N\\) is larger than \\(p\\)",
                    "\\(N\\) leaves remainder 1 when divided by any prime ‚â§ \\(p\\)",
                    "So \\(N\\) is either prime itself, or divisible by a prime > \\(p\\)",
                    "Either way, there exists a prime larger than \\(p\\)"
                ],
                contradiction: "This contradicts \\(p\\) being the largest prime",
                conclusion: "Therefore there is no largest prime"
            }
        }
    ]
};

// Explorer data
const explorerData = {
    'direct-easy': {
        statement: "If \\(n\\) is even, then \\(n^2\\) is even",
        analysis: `
            <div class="direct-emphasis">
                <h4>‚úÖ Use Direct Proof!</h4>
                <p>This has a straightforward direct proof. Start with the definition of even (n = 2k) and show n¬≤ is even.</p>
                <p><strong>Direct proof:</strong></p>
                <ul style="margin: 0.5rem 0 0 2rem;">
                    <li>Assume n = 2k</li>
                    <li>Then n¬≤ = 4k¬≤ = 2(2k¬≤)</li>
                    <li>Therefore n¬≤ is even ‚úì</li>
                </ul>
            </div>
            <div class="important-notice">
                <h4>‚ö†Ô∏è Why NOT use indirect proof?</h4>
                <p>Using contrapositive or contradiction here is poor mathematical style. It would make this simple problem unnecessarily complex. Always prefer the simplest correct approach!</p>
            </div>
        `
    },
    
    'needs-indirect': {
        statement: "If \\(n^2\\) is even, then \\(n\\) is even",
        analysis: `
            <div class="feedback-box warning">
                <h4>ü§î Direct proof is difficult here</h4>
                <p>Starting with "n¬≤ is even" doesn't easily tell us about n itself.</p>
            </div>
            <div class="direct-emphasis">
                <h4>‚ÜîÔ∏è Use Contrapositive!</h4>
                <p>The contrapositive "If n is odd, then n¬≤ is odd" is much easier to prove:</p>
                <ul style="margin: 0.5rem 0 0 2rem;">
                    <li>Assume n = 2k+1 (odd)</li>
                    <li>Then n¬≤ = (2k+1)¬≤ = 4k¬≤ + 4k + 1 = 2(2k¬≤ + 2k) + 1</li>
                    <li>So n¬≤ is odd ‚úì</li>
                </ul>
            </div>
            <button class="btn btn-primary" onclick="showAlternativePractice('contrapositive')" style="margin-top: 1rem;">
                Practice: What do you assume for contrapositive?
            </button>
        `,
        alternative: "n is odd",
        method: "contrapositive"
    },
    
    'irrational': {
        statement: "\\(\\sqrt{2}\\) is irrational",
        analysis: `
            <div class="feedback-box error">
                <h4>‚ùå Direct proof is IMPOSSIBLE</h4>
                <p>We cannot verify ‚àö2 ‚â† p/q for all infinitely many rational numbers p/q.</p>
            </div>
            <div class="direct-emphasis" style="border-color: var(--accent-amber); background: rgba(245, 158, 11, 0.05);">
                <h4 style="color: var(--accent-amber);">üí• Must use Proof by Contradiction!</h4>
                <p>This is a classic case where contradiction is necessary:</p>
                <ol style="margin: 0.5rem 0 0 2rem;">
                    <li>Assume ‚àö2 IS rational (‚àö2 = p/q in lowest terms)</li>
                    <li>Derive that both p and q must be even</li>
                    <li>This contradicts "lowest terms"</li>
                    <li>Therefore ‚àö2 must be irrational</li>
                </ol>
            </div>
            <button class="btn btn-amber" onclick="showAlternativePractice('contradiction')" style="margin-top: 1rem;">
                Practice: What do you assume for contradiction?
            </button>
        `,
        alternative: "‚àö2 is rational (‚àö2 = p/q with gcd(p,q) = 1)",
        method: "contradiction"
    },
    
    'existence': {
        statement: "There exists a real number \\(x\\) such that \\(x^2 = 4\\)",
        analysis: `
            <div class="direct-emphasis">
                <h4>‚úÖ Use Direct Proof!</h4>
                <p>For existence proofs, just provide one example:</p>
                <p style="margin: 0.5rem 0 0 2rem;">Let x = 2. Then 2¬≤ = 4. Done! ‚úì</p>
            </div>
            <div class="feedback-box info">
                <h4>üí° General Rule</h4>
                <p>To prove "there exists," find one example. To disprove "for all," find one counterexample.</p>
            </div>
        `
    }
};

// Tab switching
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        const tabId = btn.dataset.tab;
        
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        btn.classList.add('active');
        document.getElementById(tabId).classList.add('active');
        
        state.currentTab = tabId;
    });
});

// Explorer functions
function exploreStatement(type) {
    state.explorerState.statementType = type;
    const data = explorerData[type];
    
    document.getElementById('explorer-statement').innerHTML = data.statement;
    document.getElementById('strategy-analysis').innerHTML = data.analysis;
    document.getElementById('explorer-display').style.display = 'block';
    document.getElementById('alternative-practice').style.display = 'none';
    
    renderMath();
}

function showAlternativePractice(method) {
    const data = explorerData[state.explorerState.statementType];
    state.explorerState.selectedStrategy = method;
    
    document.getElementById('method-name').textContent = method;
    document.getElementById('alternative-practice').style.display = 'block';
    document.getElementById('explorer-alternative').value = '';
    document.getElementById('explorer-alternative-feedback').innerHTML = '';
}

function checkExplorerAlternative() {
    const data = explorerData[state.explorerState.statementType];
    const input = document.getElementById('explorer-alternative').value.trim();
    
    if (!input) {
        document.getElementById('explorer-alternative-feedback').innerHTML = `
            <div class="feedback-box warning">
                Please enter what you would assume!
            </div>
        `;
        return;
    }
    
    // Check if answer captures the key idea
    const isCorrect = 
        (data.method === 'contrapositive' && input.toLowerCase().includes('odd')) ||
        (data.method === 'contradiction' && input.toLowerCase().includes('rational'));
    
    document.getElementById('explorer-alternative-feedback').innerHTML = isCorrect ? `
        <div class="feedback-box success">
            <strong>Correct!</strong><br>
            For ${data.method}, we assume: ${data.alternative}
        </div>
    ` : `
        <div class="feedback-box info">
            <strong>The correct assumption is:</strong><br>
            ${data.alternative}<br>
            <small>Remember: for ${data.method}, we need to ${
                data.method === 'contrapositive' ? 'assume the negation of the conclusion' : 
                'assume the opposite of what we want to prove'
            }</small>
        </div>
    `;
    
    renderMath();
}

// Builder functions
function generateProblem() {
    const type = document.getElementById('problem-type').value;
    const problems = problemDatabase[type];
    
    // Select a random problem from the category
    const problem = problems[Math.floor(Math.random() * problems.length)];
    state.builderState.problem = problem;
    state.builderState.selectedStrategy = null;
    state.builderState.attempts = 0;
    
    document.getElementById('problem-statement').innerHTML = problem.statement;
    document.getElementById('builder-content').style.display = 'block';
    
    // Reset UI
    document.getElementById('alternative-section').style.display = 'none';
    document.getElementById('proof-construction').style.display = 'none';
    document.getElementById('strategy-feedback').innerHTML = '';
    
    // Build strategy buttons - ONLY show natural/possible strategies
    buildStrategyButtons();
    
    renderMath();
}

function buildStrategyButtons() {
    const problem = state.builderState.problem;
    let buttonsHtml = '';
    
    // Determine which strategies to show
    const strategiesToShow = [
        ...problem.naturalStrategies,
        ...(problem.possibleStrategies || [])
    ];
    
    // Add difficult strategies if no other options
    if (strategiesToShow.length === 0 && problem.difficultStrategies) {
        strategiesToShow.push(...problem.difficultStrategies);
    }
    
    // Build buttons only for valid strategies
    strategiesToShow.forEach(strategy => {
        let description = '';
        let emphasis = '';
        
        if (problem.naturalStrategies.includes(strategy)) {
            emphasis = '‚úì Recommended';
        } else if ((problem.possibleStrategies || []).includes(strategy)) {
            emphasis = 'Also works';
        } else if ((problem.difficultStrategies || []).includes(strategy)) {
            emphasis = 'Difficult but possible';
        }
        
        if (strategy === 'direct') {
            description = 'Build from hypothesis to conclusion';
        } else if (strategy === 'contrapositive') {
            description = 'Prove ¬¨Q ‚Üí ¬¨P instead';
        } else if (strategy === 'contradiction') {
            description = 'Assume negation, find impossibility';
        }
        
        buttonsHtml += `
            <div class="strategy-card" onclick="selectBuilderStrategy('${strategy}')">
                <h4>${strategy.charAt(0).toUpperCase() + strategy.slice(1)} Proof</h4>
                <p>${description}</p>
                <p style="color: var(--primary); font-weight: 600; margin-top: 0.5rem;">${emphasis}</p>
            </div>
        `;
    });
    
    // If no strategies available (shouldn't happen with proper data)
    if (buttonsHtml === '') {
        buttonsHtml = '<p>No valid strategies available for this problem.</p>';
    }
    
    document.getElementById('builder-strategy-options').innerHTML = buttonsHtml;
}

function selectBuilderStrategy(strategy) {
    const problem = state.builderState.problem;
    state.builderState.selectedStrategy = strategy;
    
    // Visual feedback
    document.querySelectorAll('#builder-strategy-options .strategy-card').forEach(card => {
        card.classList.remove('selected');
    });
    event.target.closest('.strategy-card').classList.add('selected');
    
    // Provide feedback
    const feedbackDiv = document.getElementById('strategy-feedback');
    
    // Check how many strategies are available
    const totalStrategies = [
        ...problem.naturalStrategies,
        ...(problem.possibleStrategies || []),
        ...(problem.difficultStrategies || [])
    ].length;
    
    if (problem.naturalStrategies.includes(strategy)) {
        let reason = '';
        if (strategy === 'direct') reason = problem.whyDirect;
        else if (strategy === 'contrapositive') reason = problem.whyContrapositive;
        else if (strategy === 'contradiction') reason = problem.whyContradiction;
        
        // Different message if it's the only option
        if (totalStrategies === 1) {
            feedbackDiv.innerHTML = `
                <div class="feedback-box success">
                    <strong>Correct approach!</strong><br>
                    ${reason}<br>
                    <small style="color: var(--text-muted); margin-top: 0.5rem; display: block;">
                        This is the only appropriate strategy for this problem.
                    </small>
                </div>
            `;
        } else {
            feedbackDiv.innerHTML = `
                <div class="feedback-box success">
                    <strong>Excellent choice!</strong><br>
                    ${reason}
                </div>
            `;
        }
    } else if ((problem.possibleStrategies || []).includes(strategy)) {
        feedbackDiv.innerHTML = `
            <div class="feedback-box info">
                <strong>This works too!</strong><br>
                ${strategy === 'contradiction' ? problem.whyContradiction : 'This approach is valid but may be less elegant.'}
            </div>
        `;
    } else if ((problem.difficultStrategies || []).includes(strategy)) {
        feedbackDiv.innerHTML = `
            <div class="feedback-box warning">
                <strong>This is challenging!</strong><br>
                ${problem.whyNotDirect}
            </div>
        `;
    }
    
    // Show alternative section for indirect proofs
    if (strategy !== 'direct') {
        document.getElementById('alternative-section').style.display = 'block';
        document.getElementById('chosen-method').textContent = strategy;
        document.getElementById('builder-alternative').value = '';
        document.getElementById('builder-alternative-feedback').innerHTML = '';
    } else {
        document.getElementById('alternative-section').style.display = 'none';
        buildProofStructure();
    }
}

function checkBuilderAlternative() {
    const problem = state.builderState.problem;
    const strategy = state.builderState.selectedStrategy;
    const input = document.getElementById('builder-alternative').value.trim();
    
    if (!input) {
        document.getElementById('builder-alternative-feedback').innerHTML = `
            <div class="feedback-box warning">
                Please enter your assumption!
            </div>
        `;
        return;
    }
    
    state.builderState.attempts++;
    
    // Determine correct assumption based on strategy
    let correctAssumption = '';
    if (strategy === 'contrapositive') {
        if (problem.contrapositiveProof) {
            correctAssumption = problem.contrapositiveProof.assumption;
        }
    } else if (strategy === 'contradiction') {
        if (problem.contradictionProof) {
            correctAssumption = problem.contradictionProof.assumption;
        }
    }
    
    // More intelligent checking - look for the key mathematical content
    const inputLower = input.toLowerCase();
    let isCorrect = false;
    
    // Check based on problem type
    if (problem.statement.includes('does not exist')) {
        // For non-existence, check if they're assuming existence
        isCorrect = (inputLower.includes('exist') || inputLower.includes('there is')) &&
                   inputLower.includes('integer') &&
                   (inputLower.includes('n^2') || inputLower.includes('n¬≤'));
    } else if (problem.statement.includes('irrational')) {
        // For irrationality, check if they're assuming rationality
        isCorrect = inputLower.includes('rational') && 
                   !inputLower.includes('irrational');
    } else if (strategy === 'contrapositive') {
        // For contrapositive, check for the negation of conclusion
        isCorrect = inputLower.includes('odd') && inputLower.includes('n');
    } else if (strategy === 'contradiction') {
        // For contradiction on implications, check for both parts
        if (problem.statement.includes('then')) {
            isCorrect = (inputLower.includes('even') && inputLower.includes('odd')) ||
                       (inputLower.includes('but') || inputLower.includes('and'));
        } else {
            // For other contradictions, check for opposite
            isCorrect = inputLower.includes('exist') || 
                       inputLower.includes('rational') ||
                       inputLower.includes('largest') ||
                       inputLower.includes('finite');
        }
    }
    
    if (isCorrect) {
        document.getElementById('builder-alternative-feedback').innerHTML = `
            <div class="feedback-box success">
                <strong>Correct!</strong> That's exactly right.<br>
                More formally: ${correctAssumption}<br>
                <button class="btn btn-primary" style="margin-top: 1rem;" onclick="buildProofStructure()">
                    Continue to Proof ‚Üí
                </button>
            </div>
        `;
    } else if (state.builderState.attempts <= 2) {
        // Give helpful hints for first attempts
        document.getElementById('builder-alternative-feedback').innerHTML = `
            <div class="feedback-box info">
                <strong>Not quite.</strong> ${
                    strategy === 'contradiction' ? 
                    'For proof by contradiction, assume the exact opposite of what you want to prove.' :
                    'For contrapositive, assume the negation of the conclusion.'
                }<br>
                Try again or see the answer below.
                ${state.builderState.attempts >= 2 ? `<br><br>
                <strong>The correct assumption is:</strong><br>
                ${correctAssumption}<br>
                <button class="btn btn-primary" style="margin-top: 1rem;" onclick="buildProofStructure()">
                    Continue with this ‚Üí
                </button>` : ''}
            </div>
        `;
    } else {
        // After multiple attempts, show the answer
        document.getElementById('builder-alternative-feedback').innerHTML = `
            <div class="feedback-box info">
                <strong>The correct assumption is:</strong><br>
                ${correctAssumption}<br>
                <button class="btn btn-primary" style="margin-top: 1rem;" onclick="buildProofStructure()">
                    Continue with this ‚Üí
                </button>
            </div>
        `;
    }
    
    renderMath();
}

function buildProofStructure() {
    const problem = state.builderState.problem;
    const strategy = state.builderState.selectedStrategy;
    
    document.getElementById('proof-construction').style.display = 'block';
    
    let structure = '';
    let steps = [];
    
    if (strategy === 'direct' && problem.directProof) {
        structure = `
            <div class="proof-box given">
                <div class="box-label">Given</div>
                <div>${problem.directProof.assumption}</div>
            </div>
            <div class="proof-box">
                <div class="box-label">Proof Steps (drag to reorder)</div>
                <div class="sortable-area" id="steps-area"></div>
            </div>
            <div class="proof-box conclusion">
                <div class="box-label">Therefore</div>
                <div>${problem.directProof.conclusion}</div>
            </div>
        `;
        steps = problem.directProof.steps;
        
    } else if (strategy === 'contrapositive' && problem.contrapositiveProof) {
        structure = `
            <div class="proof-box assumption">
                <div class="box-label">Contrapositive Assumption</div>
                <div>${problem.contrapositiveProof.assumption}</div>
            </div>
            <div class="proof-box">
                <div class="box-label">Proof Steps (drag to reorder)</div>
                <div class="sortable-area" id="steps-area"></div>
            </div>
            <div class="proof-box conclusion">
                <div class="box-label">Therefore</div>
                <div>${problem.contrapositiveProof.conclusion}</div>
            </div>
        `;
        steps = problem.contrapositiveProof.steps;
        
    } else if (strategy === 'contradiction' && problem.contradictionProof) {
        structure = `
            <div class="proof-box assumption">
                <div class="box-label">Assumption for Contradiction</div>
                <div>${problem.contradictionProof.assumption}</div>
            </div>
            <div class="proof-box">
                <div class="box-label">Proof Steps (drag to reorder)</div>
                <div class="sortable-area" id="steps-area"></div>
            </div>
            <div class="proof-box contradiction">
                <div class="box-label">Contradiction!</div>
                <div>${problem.contradictionProof.contradiction}</div>
            </div>
            <div class="proof-box conclusion">
                <div class="box-label">Therefore</div>
                <div>${problem.contradictionProof.conclusion}</div>
            </div>
        `;
        steps = problem.contradictionProof.steps;
    }
    
    document.getElementById('proof-structure').innerHTML = structure;
    
    // Add shuffled steps
    if (steps && steps.length > 0) {
        const shuffled = [...steps].sort(() => Math.random() - 0.5);
        const stepsArea = document.getElementById('steps-area');
        
        shuffled.forEach((step, i) => {
            const stepDiv = document.createElement('div');
            stepDiv.className = 'proof-step';
            stepDiv.draggable = true;
            stepDiv.innerHTML = step;
            stepDiv.dataset.originalIndex = steps.indexOf(step);
            
            // Drag handlers
            stepDiv.addEventListener('dragstart', handleDragStart);
            stepDiv.addEventListener('dragend', handleDragEnd);
            stepDiv.addEventListener('dragover', handleDragOver);
            stepDiv.addEventListener('drop', handleDrop);
            
            stepsArea.appendChild(stepDiv);
        });
    }
    
    renderMath();
}

// Drag and drop handlers
function handleDragStart(e) {
    state.builderState.draggedElement = e.target;
    e.target.classList.add('dragging');
}

function handleDragEnd(e) {
    e.target.classList.remove('dragging');
}

function handleDragOver(e) {
    e.preventDefault();
    const area = document.getElementById('steps-area');
    const afterElement = getDragAfterElement(area, e.clientY);
    if (afterElement == null) {
        area.appendChild(state.builderState.draggedElement);
    } else {
        area.insertBefore(state.builderState.draggedElement, afterElement);
    }
}

function handleDrop(e) {
    e.preventDefault();
}

function getDragAfterElement(container, y) {
    const draggableElements = [...container.querySelectorAll('.proof-step:not(.dragging)')];
    
    return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        
        if (offset < 0 && offset > closest.offset) {
            return { offset: offset, element: child };
        } else {
            return closest;
        }
    }, { offset: Number.NEGATIVE_INFINITY }).element;
}

function checkProof() {
    const steps = document.querySelectorAll('#steps-area .proof-step');
    let correct = true;
    
    steps.forEach((step, i) => {
        const originalIndex = parseInt(step.dataset.originalIndex);
        if (originalIndex === i) {
            step.classList.add('correct');
        } else {
            step.classList.remove('correct');
            correct = false;
        }
    });
    
    const feedbackDiv = document.getElementById('proof-feedback');
    if (correct) {
        feedbackDiv.innerHTML = `
            <div class="feedback-box success">
                <strong>Perfect!</strong> You've constructed a valid ${state.builderState.selectedStrategy} proof!
            </div>
        `;
    } else {
        feedbackDiv.innerHTML = `
            <div class="feedback-box info">
                Some steps are out of order. Green highlights show correctly placed steps.
            </div>
        `;
    }
}

function resetProof() {
    buildProofStructure();
    document.getElementById('proof-feedback').innerHTML = '';
}

function getHint() {
    const problem = state.builderState.problem;
    const hints = {
        'direct': "Think about how the given information leads to the conclusion step by step.",
        'contrapositive': "You're proving the contrapositive. Start with the negation of the conclusion.",
        'contradiction': "You've assumed the negation. Look for where the logical conflict arises."
    };
    
    document.getElementById('proof-feedback').innerHTML = `
        <div class="feedback-box info">
            <strong>Hint:</strong> ${hints[state.builderState.selectedStrategy]}
        </div>
    `;
}

// Math rendering
function renderMath() {
    if (window.renderMathInElement) {
        renderMathInElement(document.body, {
            delimiters: [
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ]
        });
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    renderMath();
});
    </script>
</body>
</html>
