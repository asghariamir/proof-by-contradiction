<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Proof Strategies | Mathswell</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/logo-mathswell-square-mirror.ico" type="image/x-icon">
    <link rel="icon" href="/logo-mathswell-square-mirror.svg" type="image/svg+xml">
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            startup: {
                ready: () => {
                    window.MathJax.startup.defaultReady();
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        :root {
            --primary-color: #0f766e;
            --primary-light: #10b981;
            --background: #f7faf9;
            --accent-amber: #f59e0b;
            --accent-red: #c62828;
            --text-primary: #212121;
            --text-muted: #4b5563;
            --container-bg: #ffffff;
            --border-color: #e5e7eb;
            --interactive-bg: #e6fffb;
            --success-color: #10b981;
            --error-color: #ef4444;
        }

        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--background);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--container-bg);
            min-height: 100vh;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        /* Mathswell Navigation */
        .mathswell-nav {
            display: flex;
            justify-content: center;
            margin: .4rem 0 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .mathswell-nav .mw-link {
            display: inline-flex;
            align-items: center;
            gap: .45rem;
            text-decoration: none;
            font-weight: 700;
            font-size: 1rem;
            color: var(--primary-color);
            padding: .3rem .7rem;
            border-radius: 999px;
            background: rgba(255,255,255,.9);
            box-shadow: 0 1px 4px rgba(0,0,0,.08);
        }
        
        .mathswell-nav .mw-link img {
            display: block;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 2rem 2rem 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .header h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .header .subtitle {
            font-size: 1.1rem;
            color: var(--text-muted);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: var(--container-bg);
            border-bottom: 2px solid var(--border-color);
            overflow-x: auto;
        }

        .tab-button {
            flex: 1;
            min-width: 150px;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            font-size: 1rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            font-weight: 600;
        }

        .tab-button:hover:not(.active) {
            background: var(--interactive-bg);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            padding: 2rem;
            animation: fadeIn 0.4s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Introduction Styles */
        .intro-section {
            max-width: 800px;
            margin: 0 auto 3rem;
        }

        .concept-explanation {
            background: var(--interactive-bg);
            border-left: 4px solid var(--primary-color);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .concept-explanation h3 {
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 1rem;
        }

        .motivation-example {
            background: var(--container-bg);
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .motivation-example h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .strategy-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 2rem 0;
        }

        @media (max-width: 768px) {
            .strategy-comparison {
                grid-template-columns: 1fr;
            }
        }

        .strategy-card {
            background: var(--container-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .strategy-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .strategy-card h4 {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
        }

        .strategy-card .strategy-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        /* Statement Types Styles */
        .statement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .statement-card {
            background: var(--container-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .statement-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .statement-card.active {
            border-color: var(--primary-color);
            background: var(--interactive-bg);
        }

        .statement-card h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .statement-example {
            background: var(--background);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-style: italic;
        }

        .alternative-practice {
            background: var(--container-bg);
            border: 2px solid var(--accent-amber);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
            text-align: center;
        }

        .alternative-practice h3 {
            color: var(--accent-amber);
            margin-bottom: 1rem;
        }

        .alternative-input {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 1.5rem 0;
            align-items: center;
        }

        .alternative-input input {
            width: 100%;
            max-width: 400px;
            padding: 0.8rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
        }

        .alternative-input input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .alternative-input button {
            padding: 0.8rem 2rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .alternative-input button:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        /* Proof Builder Styles */
        .builder-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--background);
            border-radius: 12px;
        }

        @media (max-width: 768px) {
            .builder-controls {
                grid-template-columns: 1fr;
            }
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .control-group select {
            padding: 0.8rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            font-size: 1rem;
        }

        .control-group select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .generate-btn {
            grid-column: 1 / -1;
            padding: 1rem 2rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            justify-self: center;
            max-width: 300px;
        }

        .generate-btn:hover:not(:disabled) {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .generate-btn:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }

        /* Current Problem Display */
        .current-problem {
            background: var(--interactive-bg);
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            display: none;
        }

        .current-problem.active {
            display: block;
        }

        .current-problem h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .theorem-statement {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
        }

        /* Strategy Selection */
        .strategy-selection {
            background: var(--container-bg);
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .strategy-selection h5 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .strategy-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .strategy-btn {
            padding: 1rem 1.5rem;
            background: var(--background);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .strategy-btn:hover {
            border-color: var(--primary-color);
            background: var(--interactive-bg);
        }

        .strategy-btn.selected {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .strategy-btn .strategy-label {
            font-weight: 600;
            font-size: 1.1rem;
            display: block;
            margin-bottom: 0.3rem;
        }

        .strategy-btn small {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* Alternative Practice */
        .alternative-section {
            background: var(--container-bg);
            border: 2px solid var(--accent-amber);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            display: none;
        }

        .alternative-section.active {
            display: block;
        }

        .alternative-section h5 {
            color: var(--accent-amber);
            margin-bottom: 1rem;
        }

        .alternative-input-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .alternative-input-group input {
            padding: 0.8rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            flex: 1;
            max-width: 400px;
        }

        .alternative-input-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .alternative-input-group button {
            padding: 0.8rem 1.5rem;
            background: var(--accent-amber);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .alternative-input-group button:hover {
            background: #dc8e0a;
            transform: translateY(-2px);
        }

        /* Proof Structure */
        .proof-construction {
            display: none;
        }

        .proof-construction.active {
            display: block;
        }

        .proof-construction h5 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 2rem;
            font-size: 1.3rem;
        }

        .proof-box {
            background: var(--container-bg);
            border: 3px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .proof-box.assumption {
            border-color: var(--accent-amber);
            background: rgba(245, 158, 11, 0.05);
        }

        .proof-box.steps-container {
            border-color: var(--border-color);
            background: var(--background);
        }

        .proof-box.contradiction {
            border-color: var(--accent-red);
            background: rgba(239, 68, 68, 0.05);
        }

        .proof-box.conclusion {
            border-color: var(--success-color);
            background: rgba(16, 185, 129, 0.05);
        }

        .proof-box.given {
            border-color: var(--primary-color);
            background: rgba(15, 118, 110, 0.05);
        }

        .box-label {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .statement-display {
            font-size: 1.1rem;
            padding: 0.8rem;
            background: white;
            border-radius: 6px;
            text-align: center;
        }

        .sortable-area {
            min-height: 200px;
            padding: 1rem;
            background: white;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
        }

        .proof-step {
            background: var(--container-bg);
            border: 2px solid var(--border-color);
            border-left: 5px solid var(--primary-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            cursor: grab;
            transition: all 0.3s ease;
            user-select: none;
        }

        .proof-step:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .proof-step.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .proof-step.correct {
            border-left-color: var(--success-color);
            background: rgba(16, 185, 129, 0.05);
        }

        /* Proof Controls */
        .proof-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn.hint {
            background: var(--accent-amber);
            color: white;
        }

        .control-btn.hint:hover {
            background: #dc8e0a;
            transform: translateY(-2px);
        }

        .control-btn.check {
            background: var(--primary-color);
            color: white;
        }

        .control-btn.check:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .control-btn.reset {
            background: var(--accent-red);
            color: white;
        }

        .control-btn.reset:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Feedback Display */
        .feedback-display {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .feedback-display.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 2px solid var(--success-color);
        }

        .feedback-display.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-color);
            border: 2px solid var(--error-color);
        }

        .feedback-display.info {
            background: var(--interactive-bg);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        /* Complete Proof Display */
        .complete-proof {
            background: linear-gradient(135deg, #fff, var(--interactive-bg));
            border: 3px solid var(--primary-color);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 8px 32px rgba(15, 118, 110, 0.15);
            display: none;
            animation: slideIn 0.6s ease;
        }

        .complete-proof.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .complete-proof h5 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }

        .proof-content {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            line-height: 1.8;
        }

        .proof-content p {
            margin-bottom: 1rem;
        }

        .qed {
            text-align: right;
            font-size: 1.2rem;
            margin-top: 1rem;
            color: var(--primary-color);
            font-weight: 700;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .nav-btn {
            padding: 0.8rem 2rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .nav-btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        /* Key Insights */
        .key-insights {
            background: var(--container-bg);
            border: 2px solid var(--accent-amber);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .key-insights h4 {
            color: var(--accent-amber);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .insight-item {
            margin-bottom: 1rem;
            padding-left: 1rem;
            border-left: 3px solid var(--accent-amber);
        }

        .insight-item:last-child {
            margin-bottom: 0;
        }

        .insight-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.3rem;
        }

        /* Warning Notice */
        .warning-notice {
            background: rgba(251, 191, 36, 0.1);
            color: #92400e;
            padding: 0.8rem 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            border-left: 3px solid var(--accent-amber);
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Mathswell Navigation Badge -->
        <div class="mathswell-nav">
            <a href="/" class="mw-link">
                <img src="/logo-mathswell-square-mirror.svg" alt="Mathswell" width="28" height="28">
                <span>MATHSWELL</span>
            </a>
        </div>

        <!-- Header -->
        <div class="header">
            <h1>Proof Strategies</h1>
            <p class="subtitle">Master direct and indirect proof approaches through interactive exploration</p>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-button active" data-tab="introduction">Introduction</button>
            <button class="tab-button" data-tab="alternatives">Statement Types</button>
            <button class="tab-button" data-tab="builder">Proof Builder</button>
        </div>

        <!-- Introduction Tab -->
        <div id="introduction" class="tab-content active">
            <div class="intro-section">
                <div class="concept-explanation">
                    <h3>What are Proof Strategies?</h3>
                    <p>When proving mathematical statements, you have two fundamental approaches: <strong>direct proof</strong> (work forward from what you know) or <strong>indirect proof</strong> (assume the opposite and find a contradiction). The key skill is recognizing which approach works best for your specific statement.</p>
                </div>

                <div class="motivation-example">
                    <h4>🔍 Motivation: The Power of Elimination</h4>
                    <p><strong>Scenario:</strong> There are three doors. You know there's a goat behind exactly one of them.</p>
                    <p style="margin: 1rem 0;">You open the first door - no goat. You open the second door - no goat.</p>
                    <p><strong>Conclusion:</strong> The goat must be behind the third door.</p>
                    <p style="margin: 1rem 0;"><em>You don't need to open the third door to prove this!</em> By systematically eliminating the other possibilities, you've established the truth with certainty.</p>
                    <p style="margin-top: 1rem;">This elimination strategy scales down beautifully: What if there were only <strong>two doors</strong>? Open one (no goat) → the goat must be behind the other. This is exactly how <strong>proof by contradiction</strong> works: every mathematical statement is either "true" or "false" - eliminate "false" and you've proven "true".</p>
                </div>

                <div class="strategy-comparison">
                    <div class="strategy-card">
                        <span class="strategy-icon">🎯</span>
                        <h4>Direct Proof</h4>
                        <p><strong>When:</strong> You can build a clear logical path from assumptions to conclusion</p>
                        <p><strong>How:</strong> Start with what you know, apply definitions and theorems, work step-by-step to your goal</p>
                        <p><strong>Example:</strong> "If n is even, then n² is even" - use definition of even numbers directly</p>
                    </div>

                    <div class="strategy-card">
                        <span class="strategy-icon">🔄</span>
                        <h4>Proof by Contradiction</h4>
                        <p><strong>When:</strong> Direct proof seems difficult, or the statement involves "not existing" or irrationality</p>
                        <p><strong>How:</strong> Assume the opposite of what you want to prove, derive an impossible consequence</p>
                        <p><strong>Example:</strong> "√2 is irrational" - assume it's rational and find contradiction</p>
                    </div>
                </div>

                <div class="key-insights">
                    <h4>🎯 The Real Challenge</h4>
                    <div class="insight-item">
                        <div class="insight-title">Identifying the Alternative:</div>
                        <div>The hardest part of proof by contradiction isn't finding the contradiction - it's figuring out exactly what to assume! Different statement types have different negations.</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-title">Strategic Thinking:</div>
                        <div>Ask yourself: "What would I assume for contradiction?" If that assumption gives you concrete properties to work with, contradiction might be your best path.</div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn" onclick="switchTab('alternatives')">Learn Statement Types →</button>
                    <button class="nav-btn" onclick="switchTab('builder')">Try Proof Builder →</button>
                </div>
            </div>
        </div>

        <!-- Statement Types & Alternatives Tab -->
        <div id="alternatives" class="tab-content">
            <div class="intro-section">
                <div class="concept-explanation">
                    <h3>Mastering Alternatives: What Do You Assume for Contradiction?</h3>
                    <p>Different types of mathematical statements have different negations. This is crucial for proof by contradiction - you need to know exactly what to assume!</p>
                </div>

                <div class="statement-grid">
                    <div class="statement-card active" data-type="bare" onclick="showStatementType('bare', this)">
                        <h4>Bare Statement (P)</h4>
                        <div class="statement-example">
                            <strong>Example:</strong> "√2 is irrational"
                        </div>
                        <p><strong>Alternative:</strong> Assume ¬P</p>
                        <p><strong>For contradiction:</strong> Assume "√2 is rational"</p>
                    </div>

                    <div class="statement-card" data-type="implication" onclick="showStatementType('implication', this)">
                        <h4>Implication (P → Q)</h4>
                        <div class="statement-example">
                            <strong>Example:</strong> "If n is even, then n² is even"
                        </div>
                        <p><strong>Alternative:</strong> Assume P ∧ ¬Q</p>
                        <p><strong>For contradiction:</strong> Assume "n is even but n² is odd"</p>
                    </div>

                    <div class="statement-card" data-type="universal" onclick="showStatementType('universal', this)">
                        <h4>Universal Statement (∀x P(x))</h4>
                        <div class="statement-example">
                            <strong>Example:</strong> "All primes > 2 are odd"
                        </div>
                        <p><strong>Alternative:</strong> Find x where ¬P(x)</p>
                        <p><strong>For contradiction:</strong> Find "a prime > 2 that is even"</p>
                    </div>

                    <div class="statement-card" data-type="existence" onclick="showStatementType('existence', this)">
                        <h4>Existence Statement (∃x P(x))</h4>
                        <div class="statement-example">
                            <strong>Example:</strong> "There exists an irrational number"
                        </div>
                        <p><strong>Alternative:</strong> Assume ∀x ¬P(x)</p>
                        <p><strong>For contradiction:</strong> Assume "all numbers are rational"</p>
                    </div>
                </div>

                <div class="alternative-practice">
                    <h3>Practice: Identify the Alternative</h3>
                    <div id="practice-statement">
                        Click a statement type above to see a practice problem!
                    </div>
                    <div class="alternative-input">
                        <input type="text" id="alternative-input" placeholder="What would you assume for contradiction?" disabled>
                        <button id="check-alternative" onclick="checkAlternative()" disabled>Check Answer</button>
                    </div>
                    <div id="alternative-feedback" class="feedback-display" style="display: none;"></div>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn" onclick="switchTab('builder')">Apply in Proof Builder →</button>
                </div>
            </div>
        </div>

        <!-- Proof Builder Tab -->
        <div id="builder" class="tab-content">
            <div class="intro-section">
                <div class="concept-explanation">
                    <h3>Interactive Proof Builder</h3>
                    <p>Generate dynamic proof problems with AI assistance. Choose your strategic approach, identify key assumptions, then construct the full proof step by step.</p>
                    <p style="font-size: 0.9rem; font-style: italic; color: var(--text-muted); margin-top: 1rem; opacity: 0.9;">
                        <strong>Note:</strong> The AI helper can make mistakes and may be temporarily unavailable during periods of high traffic.
                    </p>
                </div>

                <div class="builder-controls">
                    <div class="control-group">
                        <label for="statement-type">Statement Type</label>
                        <select id="statement-type">
                            <option value="bare">Bare Statement</option>
                            <option value="implication">Implication</option>
                            <option value="universal">Universal Statement</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label for="subject-area">Subject Area</label>
                        <select id="subject-area">
                            <option value="number-theory">Number Theory</option>
                            <option value="geometry">Geometry</option>
                            <option value="algebra">Algebra</option>
                            <option value="analysis">Real Analysis</option>
                        </select>
                    </div>
                    <button class="generate-btn" onclick="generateProblem()">
                        Generate Problem with AI
                    </button>
                </div>

                <div id="current-problem" class="current-problem">
                    <h4>Current Problem</h4>
                    <div id="theorem-text" class="theorem-statement"></div>
                    
                    <!-- Step 1: Strategy Selection -->
                    <div class="strategy-selection">
                        <h5>Step 1: Choose Your Proof Strategy</h5>
                        <p>Which approach seems more promising for this statement?</p>
                        <div class="strategy-buttons">
                            <button class="strategy-btn" onclick="selectBuilderStrategy('direct')">
                                <span class="strategy-label">🎯 Direct Proof</span>
                                <small>Work forward from assumptions</small>
                            </button>
                            <button class="strategy-btn" onclick="selectBuilderStrategy('contradiction')">
                                <span class="strategy-label">🔄 Proof by Contradiction</span>
                                <small>Assume the opposite</small>
                            </button>
                        </div>
                        <div id="strategy-feedback" class="feedback-display" style="display: none;"></div>
                    </div>

                    <!-- Step 2: Alternative (for contradiction only) -->
                    <div id="alternative-section" class="alternative-section">
                        <h5>Step 2: Identify What to Assume</h5>
                        <p>What would you assume for proof by contradiction?</p>
                        <div class="alternative-input-group">
                            <input type="text" id="builder-alternative-input" placeholder="Enter what you would assume...">
                            <button onclick="checkBuilderAlternative()">Check Alternative</button>
                        </div>
                        <div id="builder-alternative-feedback" class="feedback-display" style="display: none;"></div>
                    </div>

                    <!-- Proof Construction -->
                    <div id="proof-construction" class="proof-construction">
                        <h5 id="construction-title">Construct the Proof</h5>
                        
                        <div id="proof-structure">
                            <!-- Structure will be built dynamically here -->
                        </div>

                        <div class="proof-controls">
                            <button class="control-btn hint" onclick="showHint()">💡 Hint</button>
                            <button class="control-btn check" onclick="checkProof()">✅ Check Proof</button>
                            <button class="control-btn reset" onclick="resetProof()">🔄 Reset</button>
                        </div>

                        <div id="proof-feedback" class="feedback-display" style="display: none;"></div>

                        <div id="complete-proof" class="complete-proof">
                            <h5>✨ Complete Proof</h5>
                            <div id="proof-content" class="proof-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let state = {
            currentStatementType: 'bare',
            currentProblem: null,
            selectedStrategy: null,
            draggedElement: null,
            originalStepsOrder: [],
            practiceProblems: {
                bare: {
                    statement: "There are infinitely many prime numbers",
                    alternative: "There are finitely many prime numbers",
                    variations: ["there are only finitely many primes", "assume finitely many primes", "primes are finite"]
                },
                implication: {
                    statement: "If a² + b² = c², then we have a Pythagorean triple",
                    alternative: "a² + b² = c² but it's not a Pythagorean triple",
                    variations: ["a² + b² = c² and not pythagorean", "assume a²+b²=c² but not triple"]
                },
                universal: {
                    statement: "Every even number greater than 2 is composite",
                    alternative: "There exists an even number greater than 2 that is prime", 
                    variations: ["some even number > 2 is prime", "find even prime > 2"]
                },
                existence: {
                    statement: "There exists a real number x such that x² = 2",
                    alternative: "For all real numbers x, x² ≠ 2",
                    variations: ["no real x satisfies x²=2", "assume no real square root of 2"]
                }
            }
        };

        // Sample problems for builder (fallback when AI is unavailable)
        const sampleProblems = {
            'bare-number-theory': {
                statement: "√3 is irrational",
                alternative: "√3 is rational",
                preferredStrategy: "contradiction",
                hint: "Assume √3 = p/q in lowest terms, then show both p and q must be divisible by 3.",
                directProof: {
                    assumption: "We need to prove √3 is irrational",
                    conclusion: "Therefore √3 is irrational"
                },
                contradictionProof: {
                    assumption: "Assume √3 is rational, so √3 = p/q where gcd(p,q) = 1",
                    contradiction: "But gcd(p,q) = 1 and both p and q are divisible by 3 - Contradiction!"
                },
                steps: [
                    "Square both sides: 3 = p²/q²",
                    "Multiply by q²: 3q² = p²",
                    "Since p² is divisible by 3, p must be divisible by 3. Let p = 3k",
                    "Substitute: 3q² = (3k)² = 9k²",
                    "Simplify: q² = 3k²",
                    "Since q² is divisible by 3, q must be divisible by 3"
                ]
            }
        };

        // DOM references
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        // Initialize
        function init() {
            setupTabs();
            showStatementType('bare', document.querySelector('[data-type="bare"]'));
        }

        // Tab switching
        function setupTabs() {
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
        }

        function switchTab(tabId) {
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // Statement type exploration (Tab 2)
        function showStatementType(type, element) {
            // Update active state
            document.querySelectorAll('.statement-card').forEach(card => {
                card.classList.remove('active');
            });
            element.classList.add('active');
            
            state.currentStatementType = type;
            const problem = state.practiceProblems[type];
            
            document.getElementById('practice-statement').innerHTML = `
                <strong>Practice Statement:</strong> ${problem.statement}
            `;
            
            document.getElementById('alternative-input').disabled = false;
            document.getElementById('check-alternative').disabled = false;
            document.getElementById('alternative-input').placeholder = "What would you assume for contradiction?";
            document.getElementById('alternative-input').value = "";
            document.getElementById('alternative-feedback').style.display = 'none';
            
            // Typeset math if available
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([document.getElementById('practice-statement')]);
            }
        }

        function checkAlternative() {
            const userInput = document.getElementById('alternative-input').value.toLowerCase().trim();
            const problem = state.practiceProblems[state.currentStatementType];
            const correctAlternative = problem.alternative.toLowerCase();
            const variations = problem.variations.map(v => v.toLowerCase());
            
            const feedbackDiv = document.getElementById('alternative-feedback');
            feedbackDiv.style.display = 'block';
            
            const isCorrect = userInput.includes(correctAlternative.split(' ')[0]) || 
                             variations.some(variation => 
                                 userInput.includes(variation) || 
                                 variation.includes(userInput.substring(0, 10))
                             );
            
            if (isCorrect) {
                feedbackDiv.className = 'feedback-display success';
                feedbackDiv.innerHTML = `
                    <strong>Correct!</strong><br>
                    The alternative is: "${problem.alternative}"<br>
                    This gives you something concrete to work with for contradiction.
                `;
            } else {
                feedbackDiv.className = 'feedback-display error';
                feedbackDiv.innerHTML = `
                    <strong>Not quite.</strong><br>
                    The alternative should be: "${problem.alternative}"<br>
                    Remember: you need the logical negation of the original statement.
                `;
            }
            
            // Typeset math if available
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([feedbackDiv]);
            }
        }

        // AI API integration
        async function callAI(prompt, maxRetries = 2) {
            for (let attempt = 0; attempt <= maxRetries; attempt++) {
                try {
                    if (attempt > 0) {
                        await new Promise(resolve => setTimeout(resolve, 1000 * attempt));
                    }
                    
                    const response = await fetch('/api/gemini', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            contents: [{ role: "user", parts: [{ text: prompt }] }] 
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (!text) {
                        throw new Error('Empty response from AI');
                    }
                    
                    return text;
                    
                } catch (error) {
                    console.error(`AI attempt ${attempt + 1} failed:`, error);
                    if (attempt === maxRetries) {
                        throw error;
                    }
                }
            }
        }

        function extractJSON(text) {
            try {
                // Try direct JSON parse first
                return JSON.parse(text);
            } catch {
                // Try to find JSON in the response
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    throw new Error('No JSON found in response');
                }
                
                const cleaned = jsonMatch[0]
                    .replace(/```json\s*/g, '')
                    .replace(/```\s*/g, '')
                    .trim();
                
                try {
                    return JSON.parse(cleaned);
                } catch (e) {
                    throw new Error('Invalid JSON format');
                }
            }
        }

        function validateProblem(data) {
            // Validate required fields
            const required = [
                'statement', 
                'alternative', 
                'preferredStrategy', 
                'hint', 
                'directProof', 
                'contradictionProof', 
                'steps'
            ];
            
            for (const field of required) {
                if (!(field in data)) {
                    throw new Error(`Missing required field: ${field}`);
                }
            }
            
            // Validate nested fields
            if (!data.directProof.assumption || !data.directProof.conclusion) {
                throw new Error('Missing direct proof fields');
            }
            
            if (!data.contradictionProof.assumption || !data.contradictionProof.contradiction) {
                throw new Error('Missing contradiction proof fields');
            }
            
            // Validate steps is an array with at least 3 elements
            if (!Array.isArray(data.steps) || data.steps.length < 3) {
                throw new Error('Steps must be an array with at least 3 elements');
            }
            
            return data;
        }

        // Proof Builder (Tab 3)
        async function generateProblem() {
            const type = document.getElementById('statement-type').value;
            const area = document.getElementById('subject-area').value;
            const btn = document.querySelector('.generate-btn');
            
            btn.disabled = true;
            btn.textContent = 'Generating...';
            
            // Build the key from user's selection
            const key = `${type}-${area}`;
            
            // Try AI generation first
            try {
                const typeDescriptions = {
                    'bare': 'a simple statement P (like "√2 is irrational")',
                    'implication': 'an if-then statement P→Q (like "if n is even, then n² is even")',
                    'universal': 'a universal statement ∀x P(x) (like "for all integers n, n² ≥ 0")'
                };
                
                const areaDescriptions = {
                    'number-theory': 'number theory (integers, primes, divisibility, rational/irrational numbers)',
                    'geometry': 'geometry (triangles, circles, angles, areas)',
                    'algebra': 'algebra (equations, inequalities, polynomials)',
                    'analysis': 'real analysis (limits, continuity, sequences, convergence)'
                };
                
                const prompt = `Generate a mathematical proof problem.
                
Statement type: ${typeDescriptions[type]}
Subject area: ${areaDescriptions[area]}

The statement should be TRUE and suitable for proof. Create a problem that's interesting but not too complex.

Return ONLY a valid JSON object with this exact structure:
{
  "statement": "The mathematical statement to prove (use $ for inline LaTeX math)",
  "alternative": "What to assume for proof by contradiction (the negation of the statement)",
  "preferredStrategy": "direct" or "contradiction" (which approach works better),
  "hint": "A helpful hint for solving the problem",
  "directProof": {
    "assumption": "Starting point/given for direct proof",
    "conclusion": "What we conclude (typically 'Therefore [statement]')"
  },
  "contradictionProof": {
    "assumption": "What we assume for contradiction (typically 'Assume [negation]')",
    "contradiction": "The contradiction we reach (end with '- Contradiction!')"
  },
  "steps": [
    "First step of the proof",
    "Second step",
    "Third step",
    "Fourth step",
    "Fifth step",
    "Sixth step (if needed)"
  ]
}

Important requirements:
- The steps array should contain 4-6 logical steps that lead from assumption to conclusion
- Each step should be one clear sentence
- Use LaTeX notation with $ for math expressions
- The proof should be mathematically correct
- Don't include "Therefore" or conclusion statements in the steps array
- Make the problem appropriate for undergraduate mathematics

Example for reference:
For "bare statement" in "number theory", you might generate a problem about √5 being irrational, or about infinitely many primes of a certain form.

RESPOND WITH ONLY THE JSON OBJECT, NO ADDITIONAL TEXT.`;

                const response = await callAI(prompt);
                const parsed = extractJSON(response);
                state.currentProblem = validateProblem(parsed);
                
                console.log('AI generated problem:', state.currentProblem);
                
            } catch (error) {
                console.error('AI generation failed:', error);
                
                // Use fallback problems based on user's selection
                if (sampleProblems[key]) {
                    state.currentProblem = sampleProblems[key];
                } else {
                    // If exact combination doesn't exist, try to find closest match
                    const fallbackKey = Object.keys(sampleProblems).find(k => 
                        k.includes(type) || k.includes(area)
                    );
                    state.currentProblem = sampleProblems[fallbackKey] || sampleProblems['bare-number-theory'];
                }
                
                // Show subtle notification that fallback is being used
                const notification = document.createElement('div');
                notification.className = 'warning-notice';
                notification.innerHTML = 'Using pre-loaded problem (AI temporarily unavailable)';
                notification.style.position = 'fixed';
                notification.style.top = '20px';
                notification.style.right = '20px';
                notification.style.zIndex = '2000';
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }
            
            // Display the problem
            document.getElementById('theorem-text').innerHTML = state.currentProblem.statement;
            document.getElementById('current-problem').classList.add('active');
            
            // Reset UI
            resetBuilderUI();
            
            btn.disabled = false;
            btn.textContent = 'Generate Problem with AI';
            
            // Typeset math
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise();
            }
        }

        function resetBuilderUI() {
            // Clear selections
            document.querySelectorAll('.strategy-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Hide sections
            document.getElementById('alternative-section').classList.remove('active');
            document.getElementById('proof-construction').classList.remove('active');
            document.getElementById('complete-proof').classList.remove('active');
            document.getElementById('strategy-feedback').style.display = 'none';
            document.getElementById('builder-alternative-feedback').style.display = 'none';
            document.getElementById('proof-feedback').style.display = 'none';
            
            state.selectedStrategy = null;
        }

        function selectBuilderStrategy(strategy) {
            state.selectedStrategy = strategy;
            
            // Update buttons
            document.querySelectorAll('.strategy-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.closest('.strategy-btn').classList.add('selected');
            
            // Show feedback
            const feedback = document.getElementById('strategy-feedback');
            feedback.style.display = 'flex';
            
            if (strategy === state.currentProblem.preferredStrategy) {
                feedback.className = 'feedback-display success';
                feedback.innerHTML = '<strong>Excellent choice!</strong><br>This approach works well for this statement.';
            } else {
                feedback.className = 'feedback-display info';
                feedback.innerHTML = '<strong>Good thinking!</strong><br>This approach can work too. Let\'s proceed!';
            }
            
            // Show next step
            if (strategy === 'contradiction') {
                document.getElementById('alternative-section').classList.add('active');
                document.getElementById('builder-alternative-input').value = '';
                document.getElementById('builder-alternative-feedback').style.display = 'none';
            } else {
                document.getElementById('alternative-section').classList.remove('active');
                buildProofStructure();
            }
        }

        function checkBuilderAlternative() {
            const input = document.getElementById('builder-alternative-input').value.trim();
            const feedback = document.getElementById('builder-alternative-feedback');
            
            feedback.style.display = 'flex';
            
            if (input.toLowerCase().includes('rational')) {
                feedback.className = 'feedback-display success';
                feedback.innerHTML = `<strong>Correct!</strong><br>Yes, we assume: "${state.currentProblem.alternative}"`;
                setTimeout(() => buildProofStructure(), 1500);
            } else {
                feedback.className = 'feedback-display error';
                feedback.innerHTML = `<strong>Not quite.</strong><br>The correct alternative is: "${state.currentProblem.alternative}"`;
            }
        }

        function buildProofStructure() {
            const construction = document.getElementById('proof-construction');
            construction.classList.add('active');
            
            // Set title
            const title = state.selectedStrategy === 'contradiction' ?
                'Step 3: Construct the Proof by Contradiction' :
                'Step 2: Construct the Direct Proof';
            document.getElementById('construction-title').textContent = title;
            
            // Build structure
            const structure = document.getElementById('proof-structure');
            structure.innerHTML = '';
            
            if (state.selectedStrategy === 'contradiction') {
                // Contradiction proof structure: 4 boxes
                structure.innerHTML = `
                    <div class="proof-box assumption">
                        <div class="box-label">Assumption for Contradiction</div>
                        <div class="statement-display">${state.currentProblem.contradictionProof.assumption}</div>
                    </div>
                    
                    <div class="proof-box steps-container">
                        <div class="box-label">Proof Steps (arrange in correct order)</div>
                        <div class="sortable-area" id="steps-area"></div>
                    </div>
                    
                    <div class="proof-box contradiction">
                        <div class="box-label">Derive Contradiction</div>
                        <div class="statement-display">${state.currentProblem.contradictionProof.contradiction}</div>
                    </div>
                    
                    <div class="proof-box conclusion">
                        <div class="box-label">Therefore</div>
                        <div class="statement-display">${state.currentProblem.statement} ✓</div>
                    </div>
                `;
            } else {
                // Direct proof structure: 3 boxes
                structure.innerHTML = `
                    <div class="proof-box given">
                        <div class="box-label">Given/Assumption</div>
                        <div class="statement-display">${state.currentProblem.directProof.assumption}</div>
                    </div>
                    
                    <div class="proof-box steps-container">
                        <div class="box-label">Proof Steps (arrange in correct order)</div>
                        <div class="sortable-area" id="steps-area"></div>
                    </div>
                    
                    <div class="proof-box conclusion">
                        <div class="box-label">Therefore</div>
                        <div class="statement-display">${state.currentProblem.directProof.conclusion}</div>
                    </div>
                `;
            }
            
            // Add steps
            populateSteps();
            
            // Typeset math
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([structure]);
            }
        }

        function populateSteps() {
            const area = document.getElementById('steps-area');
            if (!area) return;
            
            // Store original order
            state.originalStepsOrder = [...state.currentProblem.steps];
            
            // Shuffle steps
            const shuffled = [...state.currentProblem.steps].sort(() => Math.random() - 0.5);
            
            // Create step elements
            area.innerHTML = '';
            shuffled.forEach((step, i) => {
                const div = document.createElement('div');
                div.className = 'proof-step';
                div.draggable = true;
                div.innerHTML = step;
                div.dataset.originalIndex = state.originalStepsOrder.indexOf(step);
                
                // Drag events
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragend', handleDragEnd);
                div.addEventListener('dragover', handleDragOver);
                div.addEventListener('drop', handleDrop);
                
                area.appendChild(div);
            });
        }

        // Drag and drop handlers
        function handleDragStart(e) {
            state.draggedElement = e.target;
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            const area = document.getElementById('steps-area');
            const afterElement = getDragAfterElement(area, e.clientY);
            if (afterElement == null) {
                area.appendChild(state.draggedElement);
            } else {
                area.insertBefore(state.draggedElement, afterElement);
            }
        }

        function handleDrop(e) {
            e.preventDefault();
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.proof-step:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Check proof
        function checkProof() {
            const steps = document.querySelectorAll('#steps-area .proof-step');
            let correct = true;
            
            steps.forEach((step, i) => {
                const originalIndex = parseInt(step.dataset.originalIndex);
                if (originalIndex === i) {
                    step.classList.add('correct');
                } else {
                    step.classList.remove('correct');
                    correct = false;
                }
            });
            
            const feedback = document.getElementById('proof-feedback');
            feedback.style.display = 'flex';
            
            if (correct) {
                feedback.className = 'feedback-display success';
                feedback.innerHTML = '<strong>Perfect!</strong> Your proof is logically correct!';
                showCompleteProof();
            } else {
                feedback.className = 'feedback-display info';
                feedback.innerHTML = 'Not quite right. Green steps are correctly placed.';
            }
        }

        // Show complete proof
        function showCompleteProof() {
            const completeProof = document.getElementById('complete-proof');
            const content = document.getElementById('proof-content');
            
            let html = `<p><strong>Theorem:</strong> ${state.currentProblem.statement}</p>`;
            
            if (state.selectedStrategy === 'contradiction') {
                html += `<p><strong>Proof by Contradiction:</strong></p>`;
                html += `<p>${state.currentProblem.contradictionProof.assumption}</p>`;
                state.currentProblem.steps.forEach(step => {
                    html += `<p>${step}</p>`;
                });
                html += `<p>${state.currentProblem.contradictionProof.contradiction}</p>`;
                html += `<p>Therefore, ${state.currentProblem.statement}.</p>`;
            } else {
                html += `<p><strong>Direct Proof:</strong></p>`;
                html += `<p>${state.currentProblem.directProof.assumption}</p>`;
                state.currentProblem.steps.forEach(step => {
                    html += `<p>${step}</p>`;
                });
                html += `<p>${state.currentProblem.directProof.conclusion}</p>`;
            }
            
            html += '<div class="qed">∎</div>';
            
            content.innerHTML = html;
            completeProof.classList.add('active');
            
            // Typeset math
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([content]);
            }
        }

        // Reset proof
        function resetProof() {
            populateSteps();
            document.querySelectorAll('.proof-step').forEach(step => {
                step.classList.remove('correct');
            });
            document.getElementById('proof-feedback').style.display = 'none';
            document.getElementById('complete-proof').classList.remove('active');
        }

        // Show hint
        function showHint() {
            const feedback = document.getElementById('proof-feedback');
            feedback.style.display = 'flex';
            feedback.className = 'feedback-display info';
            feedback.innerHTML = `<strong>💡 Hint:</strong> ${state.currentProblem.hint}`;
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
